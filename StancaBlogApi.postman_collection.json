{
  "info": {
    "_postman_id": "b6f7f18c-3f1f-4b2a-8b2c-9b3c9e3a2a11",
    "name": "StancaBlogApi",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    { "key": "baseUrl", "value": "https://localhost:5001" },
    { "key": "token", "value": "" },
    { "key": "userId", "value": "" },
    { "key": "postId", "value": "" },
    { "key": "commentId", "value": "" },
    { "key": "categoryId", "value": "1" }
  ],
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "Register",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": { "raw": "{{baseUrl}}/api/Auth/register", "host": ["{{baseUrl}}"], "path": ["api", "Auth", "register"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"anna\",\n  \"email\": \"anna@test.se\",\n  \"password\": \"secret123\"\n}"
            }
          }
        },
        {
          "name": "Login",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": { "raw": "{{baseUrl}}/api/Auth/login", "host": ["{{baseUrl}}"], "path": ["api", "Auth", "login"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"anna\",\n  \"password\": \"secret123\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "let res = pm.response.json();",
                  "if (res && res.token) { pm.collectionVariables.set('token', res.token); }",
                  "if (res && res.userId) { pm.collectionVariables.set('userId', res.userId); }"
                ]
              }
            }
          ]
        },
        {
          "name": "Update Me",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{token}}" }
            ],
            "url": { "raw": "{{baseUrl}}/api/Auth/me", "host": ["{{baseUrl}}"], "path": ["api", "Auth", "me"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"anna2\",\n  \"email\": \"anna2@test.se\"\n}"
            }
          }
        },
        {
          "name": "Change Password",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{token}}" }
            ],
            "url": { "raw": "{{baseUrl}}/api/Auth/me/password", "host": ["{{baseUrl}}"], "path": ["api", "Auth", "me", "password"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"currentPassword\": \"secret123\",\n  \"newPassword\": \"secret456\"\n}"
            }
          }
        },
        {
          "name": "Delete Me",
          "request": {
            "method": "DELETE",
            "header": [{ "key": "Authorization", "value": "Bearer {{token}}" }],
            "url": { "raw": "{{baseUrl}}/api/Auth/me", "host": ["{{baseUrl}}"], "path": ["api", "Auth", "me"] }
          }
        }
      ]
    },
    {
      "name": "Categories",
      "item": [
        {
          "name": "Get All",
          "request": {
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/api/Categories", "host": ["{{baseUrl}}"], "path": ["api", "Categories"] }
          }
        }
      ]
    },
    {
      "name": "BlogPosts",
      "item": [
        {
          "name": "Get All",
          "request": {
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/api/BlogPosts", "host": ["{{baseUrl}}"], "path": ["api", "BlogPosts"] }
          }
        },
        {
          "name": "Search by Title",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/BlogPosts?search=första",
              "host": ["{{baseUrl}}"],
              "path": ["api", "BlogPosts"],
              "query": [{ "key": "search", "value": "första" }]
            }
          }
        },
        {
          "name": "Filter by Category",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/BlogPosts?categoryId={{categoryId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "BlogPosts"],
              "query": [{ "key": "categoryId", "value": "{{categoryId}}" }]
            }
          }
        },
        {
          "name": "Get By Id",
          "request": {
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/api/BlogPosts/{{postId}}", "host": ["{{baseUrl}}"], "path": ["api", "BlogPosts", "{{postId}}"] }
          }
        },
        {
          "name": "Create",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{token}}" }
            ],
            "url": { "raw": "{{baseUrl}}/api/BlogPosts", "host": ["{{baseUrl}}"], "path": ["api", "BlogPosts"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Mitt första inlägg\",\n  \"content\": \"Hej världen!\",\n  \"categoryId\": {{categoryId}}\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "  try {",
                  "    const body = pm.response.json();",
                  "    if (body && body.id) { pm.collectionVariables.set('postId', body.id); }",
                  "  } catch(e) {}",
                  "  const loc = pm.response.headers.get('Location');",
                  "  if (loc) {",
                  "    const parts = loc.split('/');",
                  "    pm.collectionVariables.set('postId', parts[parts.length - 1]);",
                  "  }",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Update",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{token}}" }
            ],
            "url": { "raw": "{{baseUrl}}/api/BlogPosts/{{postId}}", "host": ["{{baseUrl}}"], "path": ["api", "BlogPosts", "{{postId}}"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Uppdaterad titel\",\n  \"content\": \"Uppdaterad text\",\n  \"categoryId\": {{categoryId}}\n}"
            }
          }
        },
        {
          "name": "Delete",
          "request": {
            "method": "DELETE",
            "header": [{ "key": "Authorization", "value": "Bearer {{token}}" }],
            "url": { "raw": "{{baseUrl}}/api/BlogPosts/{{postId}}", "host": ["{{baseUrl}}"], "path": ["api", "BlogPosts", "{{postId}}"] }
          }
        }
      ]
    },
    {
      "name": "Comments",
      "item": [
        {
          "name": "Get By Post",
          "request": {
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/api/blogposts/{{postId}}/comments", "host": ["{{baseUrl}}"], "path": ["api", "blogposts", "{{postId}}", "comments"] }
          }
        },
        {
          "name": "Create",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{token}}" }
            ],
            "url": { "raw": "{{baseUrl}}/api/blogposts/{{postId}}/comments", "host": ["{{baseUrl}}"], "path": ["api", "blogposts", "{{postId}}", "comments"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"content\": \"Nice!\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "  const body = pm.response.json();",
                  "  if (body && body.id) { pm.collectionVariables.set('commentId', body.id); }",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Update",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{token}}" }
            ],
            "url": { "raw": "{{baseUrl}}/api/comments/{{commentId}}", "host": ["{{baseUrl}}"], "path": ["api", "comments", "{{commentId}}"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"content\": \"Ändrad kommentar\"\n}"
            }
          }
        },
        {
          "name": "Delete",
          "request": {
            "method": "DELETE",
            "header": [{ "key": "Authorization", "value": "Bearer {{token}}" }],
            "url": { "raw": "{{baseUrl}}/api/comments/{{commentId}}", "host": ["{{baseUrl}}"], "path": ["api", "comments", "{{commentId}}"] }
          }
        }
      ]
    }
  ]
}
